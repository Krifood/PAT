# 飞参解析工具 PAT

# 引言
本文件是对综合软件飞参解析工具 ParamAnalysisTool 的需求描述与分解。
目标是实现一款飞参解析工具软件，可以对记载日志内容进行解析与展示，目的是方便设计人员对飞机飞行过程中记录的各项原始数据进行分析，校对设计功能正确性。

# 概述
飞参解析工具软件旨在对飞行原始数据解析与展示，满足设计人员对原始数据校对飞行实际飞行状态是否符合预期的需求。在满足已有飞行参数距离解析功能的基础上，需要支持对自定义飞参条目格式自定义，包括对飞参数据条目的扩展，包括新增、调整、删除等操作，支持多类型飞参数据格式的解析。

此软件开发过程中几乎无其他外部依赖，使用时仅依赖原始飞参数据以及与之对应的飞参数据解析格式。

当前设计软件系统包包括以下模块：
目录管理模块、格式文件管理模块、数据文件管理模块、数据解析功能模块、数据展示功能模块。

格式加载模块、数据加载模块、解析模块、展示模块、格式模板设计模块、格式管理模块、数据管理模块、菜单/目录管理模块、属性配置模块。

# 功能模块拆分
## 目录管理

- 提供顶层工具菜单栏
- 提供右键菜单
- 提供图像合并功能（允许混合单位合并展示，单位栏提示“混合单位”）

## 格式文件管理

- 支持加载格式文件
- 支持对解析格式文件的新建、打开、编辑、保存
- 支持格式文件合法性校验（字段完整性/类型检查）
- 支持格式文件模板

### 格式文件内容

#### 1. 格式文件分组与信号
- 格式文件应当支持分组解析，组/子组仅用于信号归类与展示，不参与实际解析。
- 组路径使用“/”表达层级，例如 `Group/SubGroup`。
- 信号始终以 `signals` 列表给出，解析只使用 signal 的解析字段。

#### 2. JSON 字段约定（建议/默认）
```json
{
  "record_size": 16,
  "endianness": "little",
  "time_unit": "s",
  "signals": [
    {
      "name": "sig1",
      "description": "",
      "byte_offset": 0,
      "value_type": "int16",
      "scale": 1.0,
      "bias": 0.0,
      "time_scale": 1.0,
      "time_unit": "s",
      "unit": "",
      "group": "Group/SubGroup"
    }
  ],
  "groups": [
    {
      "path": "Group/SubGroup",
      "description": "组说明"
    }
  ]
}
```

#### 3. 字段说明
- `record_size`：单条记录字节长度，必须 > 0
- `endianness`：字节序，支持 `little` / `big`
- `signals`：信号数组，每个信号至少包含 `name`、`byte_offset`、`value_type`
- `value_type`：支持 `int16` / `uint16` / `int32` / `uint32` / `float32` / `float64`
- `scale` / `bias`：解析数值线性变换 `value * scale + bias`
- `time_scale`：时间轴比例尺（每条记录的时间增量，单位由 `time_unit` 解释）
- `time_unit`：时间单位（格式级别统一时间轴单位，信号级别可覆盖）
- `unit`：信号单位，仅用于展示
- `description`：信号说明，仅用于展示
- `group`：分组路径，仅用于展示
- `groups`：可选的组说明列表，通过 `path` 关联分组路径

#### 4. 约束与约定
- `time_scale` 必须 > 0，非法值默认按 1.0 处理
- 未设置 `time_unit` 时默认按 `s` 处理；信号级别单位会换算到格式级别单位
- `group` 与 `groups.path` 都使用 “/” 作为层级分隔符
- 组/子组/信号的说明字段只用于展示，不参与解析

## 数据文件管理

- 支持加载数据文件
- 支持数据文件的导入（统一由文件选择对话框完成）
- 大文件应避免一次性阻塞 UI（必要时提供抽样显示能力）

## 数据解析功能

- 支持数据实时解析能力（规划项）
- 支持将数据文件按格式文件规则进行解析
- 支持更改格式文件后重解析
- 支持以当前格式文件解析其他数据文件
- 支持数据的极值统计（每信号 min/max）
- 支持异常数据检查功能（规划项，建议通过阈值字段或规则插件实现）
- 支持多组数据文件、多组格式文件独立匹配独立解析（规划项）

## 数据展示功能

- 支持多组数据同时展示
- 支持多组数据合并展示
- 提供辅助线功能
- 同组数据时间轴统一
- 支持数据图表缩放
- 支持图像框选聚焦能力

### 页面布局

1. 主页面分为四部分：菜单栏、信号区、画布展示区、辅助显示栏。
   - 菜单栏在顶层，提供文件导入等功能
   - 信号区在菜单栏下方，界面左侧以边栏形式存在
   - 画布展示区在信号区右侧，包含可滚动的子画布区域
   - 辅助显示栏用于显示解析点数、解析状态等辅助信息
2. 子画布共享主画布展示区；随着子画布增加需要调整展示比例，但高度不小于主画布高度的 1/6。
3. 子画布支持拖拽与合并；支持从信号区拖拽到子画布中合并展示。
4. 所有子画布共享横轴；缩放时所有子画布一起缩放；允许横轴拖拽游移展示中心。

### 游标与辅助功能

1. 游标移动时显示垂直辅助线，强调数据关系。
2. 应在交点处显示横纵坐标值。
3. 支持框选放大，放大时所有子图同步缩放。
4. 支持游标菜单，提供一键复原展示比例。

### 信号区功能

1. 左侧信号区展示格式文件中的数据内容，包括组/子组/信号名、说明、时间比例尺。
2. 组/子组/信号之间存在缩进强调递进关系，支持组/子组折叠。
3. 支持按组/子组/信号三级粒度开启/关闭子图展示。
4. 支持从信号区拖拽组/子组/信号到展示区，拖到空白处视为独立子图，拖到子图中视为合并展示。

### 子图表时间轴

1. 所有信号共享时间轴：横轴由记录拍数与 `time_scale` 计算得到，并按 `time_unit` 统一到同一单位。
2. 横轴应支持时间单位显示（ms/s），可通过 `time_scale` 与显示逻辑进行换算。
3. 当 `time_scale` 不一致时，以信号本身的缩放结果作为实际横轴值展示。
